<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container mt-4">
        <h1 class="text-center text-primary">üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h1>

        <!-- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
        <div class="input-group my-3">
            <input type="text" id="search" class="form-control" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ SID ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠..."
                onkeyup="searchStudent()">
            <button class="btn btn-primary" onclick="fetchStudents()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
        <table class="table table-bordered table-striped text-center">
            <thead class="table-primary">
                <tr>
                    <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (SID)</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                    <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="studentList"></tbody>
        </table>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
    </div>

    <!-- Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="studentSID" class="form-control my-2" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                    <input type="text" id="studentName" class="form-control my-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="addStudent()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editId">
                    <input type="text" id="editSID" class="form-control my-2" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                    <input type="text" id="editName" class="form-control my-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-warning" onclick="updateStudent()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchStudents() {
            const res = await fetch("http://10.53.1.30:3000/students");
            const students = await res.json();
            displayStudents(students);
        }

        function displayStudents(students) {
            const list = document.getElementById("studentList");
            list.innerHTML = "";
            students.forEach(student => {
                list.innerHTML += `
                    <tr>
                        <td>${student.SID}</td>
                        <td>${student.name}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="showEditModal('${student._id}', '${student.SID}', '${student.name}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student._id}')">üóëÔ∏è ‡∏•‡∏ö</button>
                        </td>
                    </tr>`;
            });
        }

        async function addStudent() {
            const SID = document.getElementById("studentSID").value;
            const name = document.getElementById("studentName").value;
            if (SID === "" || name === "") {
                alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }
            await fetch("http://localhost:3000/students", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ SID, name }),
            });
            fetchStudents();
            document.getElementById("studentSID").value = "";
            document.getElementById("studentName").value = "";
            new bootstrap.Modal(document.getElementById('addModal')).hide();
        }

        async function deleteStudent(id) {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                await fetch(`http://localhost:3000/students/${id}`, { method: "DELETE" });
                fetchStudents();
            }
        }

        function showEditModal(id, SID, name) {
            document.getElementById("editId").value = id;
            document.getElementById("editSID").value = SID;
            document.getElementById("editName").value = name;
            new bootstrap.Modal(document.getElementById('editModal')).show();
        }

        async function updateStudent() {
            const id = document.getElementById("editId").value;
            const SID = document.getElementById("editSID").value;
            const name = document.getElementById("editName").value;
            if (SID === "" || name === "") {
                alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }
            await fetch(`http://localhost:3000/students/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ SID, name }),
            });
            fetchStudents();
            new bootstrap.Modal(document.getElementById('editModal')).hide();
        }

        async function searchStudent() {
            const query = document.getElementById("search").value;
            const res = await fetch(`http://localhost:3000/students/search/${query}`);
            const students = await res.json();
            displayStudents(students);
        }

        fetchStudents();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>